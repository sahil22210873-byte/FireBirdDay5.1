QUICK REFERENCE - NPC MOVEMENT SYSTEM (UPDATED)
===============================================

WHAT'S NEW:
-----------
✓ Intelligent turn detection (Left, Right, 180)
✓ Three-stage walking cycle (Start → Walk → Stop)
✓ Y-axis position locking (movement only on X and Z)
✓ Smooth animation transitions
✓ Root motion compatible
✓ NPC always faces player when idle (NEW!)

LATEST UPDATE - PLAYER TRACKING:
--------------------------------
The NPC now automatically faces toward the player when idle:
  - Works during idle animations (standing, waiting)
  - Smoothly rotates on Y-axis only
  - Automatically disabled during movement, turns, and gestures
  - Auto-detects player camera (XR Rig or Main Camera)
  - Can be toggled on/off in Inspector

HOW IT WORKS:
-------------
- When NPC is in idle state (not moving/turning/gesturing)
- Every frame, calculates direction to player
- Smoothly rotates to face player using Slerp
- Only rotates on Y-axis (horizontal rotation)
- Respects all other animations and states

KEY SCRIPT CHANGES:
-------------------

1. Movement System:
   - Y position is locked to initial height
   - Turn animations play BEFORE walking starts
   - Script calculates angle to target and chooses appropriate turn
   
2. Turn Logic:
   - Angle < 30°: No turn needed
   - Angle 30° - 150°: Left or Right turn
   - Angle > 150°: 180 turn

3. Walking Sequence:
   OLD: Just "Walk" trigger
   NEW: StartWalking → Walking loop → StopWalking → Idle

4. Player Tracking (NEW):
   - NPC smoothly rotates to face player when idle
   - Only active when not moving, turning, or gesturing
   - Auto-finds player camera if not assigned
   - Can be toggled on/off in Inspector

INSPECTOR SETTINGS (NPCMovementController):
------------------------------------------
Movement Settings:
  - Movement Speed: 1.5 (adjust to match walk animation speed)
  - Arrival Distance: 0.1
  - Turn Angle Threshold: 30 (degrees before triggering turn)

Player Tracking (NEW):
  - Player Transform: Auto-detected (XR Main Camera or Camera.main)
  - Idle Rotation Speed: 2.0 (how fast NPC rotates to face player)
  - Face Player When Idle: ✓ Enabled (uncheck to disable)

Target Positions:
  - First Position: char_position_guidance1
  - Second Position: char_position_guidance2

Animation Triggers (match your animator):
  - Wave Gesture Trigger: "Wave"
  - Idle Trigger: "Idle"
  - Start Walking Trigger: "StartWalking"
  - Stop Walking Trigger: "StopWalking"
  - Left Turn Trigger: "LeftTurn"
  - Right Turn Trigger: "RightTurn"
  - Turn 180 Trigger: "Turn180"

Animation Parameters:
  - Is Walking Bool: "IsWalking"

Voiceover Settings:
  - Voiceover Audio Source: AudioSource component
  - Voiceover Duration 1/2/3: Audio clip lengths

PLAYER TRACKING BEHAVIOR:
-------------------------
WHEN ACTIVE (NPC faces player):
  ✓ During Idle animation
  ✓ While waiting for voiceover
  ✓ After arriving at destination

WHEN INACTIVE (NPC doesn't track player):
  ✗ During wave/gesture animations
  ✗ During turn animations
  ✗ During walking sequences
  ✗ While moving to target

ANIMATION FLOW EXAMPLE (WITH PLAYER TRACKING):
----------------------------------------------
Player enters trigger 1:
  1. NPC plays Wave gesture (NOT tracking player)
  2. Returns to Idle (TRACKING player - smoothly faces them)
  3. Voiceover plays (TRACKING player - keeps facing them)
  4. Calculates angle to char_position_guidance1
  5. Plays turn animation if needed (NOT tracking)
  6. Plays StartWalking (NOT tracking)
  7. Walks toward target (NOT tracking)
  8. Plays StopWalking (NOT tracking)
  9. Returns to Idle (TRACKING player again)

COMMON ADJUSTMENTS:
------------------
1. Character turns too slowly toward waypoint:
   → Decrease Turn Angle Threshold (try 20 or 15)

2. Character doesn't turn enough:
   → Increase turn animation wait times in GetTurnAnimationLength()

3. Walking looks jerky:
   → Adjust Movement Speed to match animation
   → Check transition durations in Animator (0.2s recommended)

4. Character slides during walk:
   → Enable Root Motion if animations have it
   → Match Movement Speed to animation speed

5. Y position still drifts:
   → Already locked in script
   → Check animation import: Root Transform Position (Y) = Original

6. NPC doesn't face player when idle (NEW):
   → Check "Face Player When Idle" is enabled
   → Verify Player Transform is assigned or auto-detected
   → Check Console for "Auto-found player: [name]" message
   → Adjust "Idle Rotation Speed" (higher = faster rotation)

7. NPC rotates too fast/slow when idle (NEW):
   → Adjust "Idle Rotation Speed"
   → Default: 2.0
   → Slower (1.0-1.5): More gradual, natural rotation
   → Faster (3.0-5.0): Snappier, more responsive rotation

8. NPC keeps rotating during gestures (NEW):
   → This shouldn't happen - check that isGesturing is properly set
   → Verify wave animation is triggering properly

9. Want to disable player tracking:
   → Uncheck "Face Player When Idle" in Inspector
   → NPC will maintain forward direction when idle

AUTO-DETECTION OF PLAYER:
-------------------------
The script automatically searches for player in this order:
1. Checks if Player Transform is manually assigned
2. Searches for "XR Origin (XR Rig)/Camera Offset/Main Camera"
3. Falls back to Camera.main (first camera tagged MainCamera)
4. Logs found player name in Console
5. Warns if no player found

If auto-detection fails:
  → Manually assign Player Transform in Inspector
  → Drag the Main Camera or XR Camera to the field

TESTING PLAYER TRACKING:
------------------------
1. Enter Play Mode
2. Check Console for "Auto-found player: Main Camera" (or similar)
3. Stand in front of NPC while it's idle
4. NPC should slowly rotate to face you
5. Move to the side - NPC should follow your position
6. Trigger a gesture - NPC should stop tracking
7. After gesture completes - NPC should resume tracking

DEBUG CONSOLE MESSAGES:
-----------------------
Watch for these messages to track behavior:
  - "Auto-found player: [name]" - Player detected successfully
  - "Player transform not found!" - Auto-detection failed
  - "Angle to target: X degrees" - Turn calculation
  - "Performing [left/right/180] turn"
  - "Playing wave gesture animation"
  - "Playing start walking animation"
  - "Arrived at target position"
  - "Playing stop walking animation"

PERFORMANCE NOTES:
------------------
- Player tracking uses Slerp every frame when idle
- Very lightweight operation (minimal performance impact)
- Only active when NPC is idle (not every frame)
- No raycasts or physics calculations involved
